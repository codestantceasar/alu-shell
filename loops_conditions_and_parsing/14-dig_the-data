#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code, displaying occurrence number, IP, and HTTP_CODE using awk

# Define the Apache access log file
log_file="apache-access.log"

# Check if the log file exists
if [ ! -f "$log_file" ]; then
    echo "Error: Log file '$log_file' not found."
    exit 1
fi

# Use awk to count occurrences of each (IP, HTTP_CODE) pair
# Then, sort the results in descending order based on occurrence count
awk '{count[$1, $9]++} END {for (key in count) {split(key, arr, SUBSEP); print count[key], arr[1], arr[2]}}' "$log_file" | sort -nr
